window.__require=function e(i,t,s){function r(h,n){if(!t[h]){if(!i[h]){var c=h.split("/");if(c=c[c.length-1],!i[c]){var a="function"==typeof __require&&__require;if(!n&&a)return a(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+h+"'")}h=c}var l=t[h]={exports:{}};i[h][0].call(l.exports,function(e){return r(i[h][1][e]||e)},l,l.exports,e,i,t,s)}return t[h].exports}for(var o="function"==typeof __require&&__require,h=0;h<s.length;h++)r(s[h]);return r}({Game:[function(e,i){"use strict";cc._RF.push(i,"26a8540r/BFfp/D2qFhmmRf","Game");var t=e("./shape"),s=e("./chessType");cc.Class({extends:cc.Component,properties:{tilePrefab:cc.Prefab,bgtilePrefab:cc.Prefab,chessPrefab:cc.Prefab,shapeContainer:cc.Node,shapeBoard:cc.Node,restartNode:cc.Node,pauseNode:cc.Node,pauseResumeBtn:cc.Node,pausePic:cc.SpriteFrame,resumePic:cc.SpriteFrame,scoreLabel:cc.Label,RscoreLabel:cc.Label,FscoreLabel:cc.Label,aimNode:cc.Node,bgAudio:{default:null,type:cc.AudioClip},btnAudio:{default:null,type:cc.AudioClip},dropAudio:{default:null,type:cc.AudioClip},pauseResumeAudio:{default:null,type:cc.AudioClip},removeAudio:{default:null,type:cc.AudioClip},loseAudio:{default:null,type:cc.AudioClip}},onLoad:function(){this.initUserInfoButton(),this.passiveShare(),this.registerEvent_monitor(),this.crazy=cc.sys.localStorage.getItem("Mcrazy"),console.log("crazy"+this.crazy),this.registerEvent(),this.row=15,this.col=10,this.frequency=0,this.preJuTile=[],this.colorRecover=[],this.tileWidth=this.shapeBoard.width/this.col,this.tileHeight=this.shapeBoard.height/this.row,console.log(this.tileHeight,this.tileWidth),this.tilePool=new cc.NodePool,this.tilePool1=new cc.NodePool,this.chessPool=new cc.NodePool,this.makeShape(),1==this.crazy&&this.scheduleOnce(function(){this.upAFewMode()},1),1==this.crazy&&this.scheduleOnce(function(){this.upAFewMode()},1),1==this.crazy&&this.scheduleOnce(function(){this.upAFewMode()},1),this.confirmedTileArray=[],this.schedule(this.moveDown,1),this.schedule(this.recoverPreJudge,.1),this.schedule(this.preJudge,.1),this.isPaused=!1,this.end=!1,this.score=0,this.loadBg(),cc.audioEngine.playMusic(this.bgAudio,!0),cc.audioEngine.setMusicVolume(.7)},loadBg:function(){for(var e=0;e<this.row;e++)for(var i=0;i<this.col;i++){var t=cc.instantiate(this.bgtilePrefab);console.log(this.tileWidth),t.width=this.tileWidth-1,t.height=this.tileHeight-1,this.shapeContainer.addChild(t)}},addScore:function(){this.score+=1,this.scoreLabel.string="\u5206\u6570\uff1a"+String(this.score),this.RscoreLabel.string="\u5206\u6570\uff1a"+String(this.score),this.FscoreLabel.string="\u5206\u6570\uff1a"+String(this.score)},getColor:function(){var e=Math.round(255*Math.random()),i=Math.round(255*Math.random()),t=Math.round(255*Math.random());return new cc.Color(e,i,t)},makeShape:function(){this.frequency++,this.tileType=this.makeType(),console.log("type:"+this.tileType),this.shapeTileArray=[],1==this.tileType?this.makeTile():this.makeChess()},makeType:function(){return console.log("crazy\uff1a"+this.crazy),1==this.crazy?(console.log("msmmsm"),0):this.frequency<=8?(console.log(this.frequency),1):Math.floor(10*Math.random())%2?0:1},makeTile:function(){this.color=this.getColor();var e=Math.floor(Math.random()*(this.col-4))+2,i=e*this.tileWidth,t=2*this.tileHeight,s=this.getTile();s.color=this.color,s.position=cc.v2(i,t),s.width=this.tileWidth,s.height=this.tileHeight,this.shapeBoard.addChild(s),this.shapeTileArray.push(s);for(var r=this.getShapeCoords(),o=1;o<r.length;o++){var h=(r[o][0]+e)*this.tileWidth,n=(r[o][1]+2)*this.tileHeight,c=this.getTile();c.color=this.color,c.position=cc.v2(h,n),c.width=this.tileWidth,c.height=this.tileHeight,this.shapeBoard.addChild(c),this.shapeTileArray.push(c)}},makeChess:function(){var e=(Math.floor(Math.random()*(this.col-4))+2)*this.tileWidth,i=2*this.tileHeight,t=this.getChess();this.chessType=this.getChessType(),console.log(this.chessType),cc.resources.load(this.chessType,cc.SpriteFrame,function(e,i){e?cc.log(e):t.getComponent(cc.Sprite).spriteFrame=i}.bind(this)),t.position=cc.v2(e,i),t.width=this.tileWidth,t.height=this.tileHeight,this.shapeBoard.addChild(t),this.shapeTileArray.push(t)},getTile:function(){return this.tilePool.size()>0?this.tilePool.get():cc.instantiate(this.tilePrefab)},getChess:function(){return cc.instantiate(this.tilePrefab)},getShapeCoords:function(){var e=["squareShape","lineShape","tShape","zShape","zShapeMirror","lShape","lShapeMirror"];this.shape=e[Math.floor(Math.random()*e.length)];var i=t.SHAPE_COORDS[this.shape];return this.num=Math.floor(Math.random()*i.length),i[this.num]},getChessType:function(){var e=["horse","elephant","handsome","scholar","car","cannon","soldier"];return e[Math.floor(Math.random()*e.length)]},leftBtn:function(){if(this.recoverPreJudge(),this.preJudge(),!this.isPaused&&!this.end){for(var e=0;e<this.shapeTileArray.length;e++){var i=Math.round(this.shapeTileArray[e].x-this.tileWidth),t=Math.round(this.shapeTileArray[e].y);if(i<0)return;for(var s=0;s<this.confirmedTileArray.length;s++){var r=Math.round(this.confirmedTileArray[s].x),o=Math.round(this.confirmedTileArray[s].y);if(r==i&&o==t)return}}for(var h=0;h<this.shapeTileArray.length;h++)this.shapeTileArray[h].x-=this.tileWidth}},dropBtn:function(){if(!this.isPaused&&!this.end)for(cc.audioEngine.playEffect(this.dropAudio,!1);;)if(!this.moveDown())return},moveDown:function(){var e=this;this.recoverPreJudge(),this.preJudge();for(var i=0;i<this.shapeTileArray.length;i++){var t=Math.round(this.shapeTileArray[i].x),s=Math.round(this.shapeTileArray[i].y-this.tileHeight);if(Math.abs(s)>=this.shapeBoard.height)return this.shapeTileArray.forEach(function(i){1==e.tileType?e.confirmedTileArray.push(i):e.chessPool.put(i)}),0==this.tileType&&this.chessRemove(),1==this.crazy&&this.scheduleOnce(function(){this.upAFewMode()},1),this.makeShape(),!1;for(var r=0;r<this.confirmedTileArray.length;r++){var o=Math.round(this.confirmedTileArray[r].x),h=Math.round(this.confirmedTileArray[r].y);if(o==t&&h==s)return this.shapeTileArray.forEach(function(i){1==e.tileType?e.confirmedTileArray.push(i):e.chessPool.put(i)}),this.judgeLose()&&this.lose(),0==this.tileType&&this.chessRemove(),1==this.crazy&&(console.log("jjjjjjjj"),this.scheduleOnce(function(){this.upAFewMode()},1)),this.makeShape(),!1}}for(var n=0;n<this.shapeTileArray.length;n++)this.shapeTileArray[n].y-=this.tileHeight;return!0},rightBtn:function(){if(this.recoverPreJudge(),this.preJudge(),!this.isPaused&&!this.end){for(var e=0;e<this.shapeTileArray.length;e++){var i=Math.round(this.shapeTileArray[e].x+this.tileWidth),t=Math.round(this.shapeTileArray[e].y);if(i>=this.shapeBoard.width)return;for(var s=0;s<this.confirmedTileArray.length;s++){var r=Math.round(this.confirmedTileArray[s].x),o=Math.round(this.confirmedTileArray[s].y);if(r==i&&o==t)return}}for(var h=0;h<this.shapeTileArray.length;h++)this.shapeTileArray[h].x+=this.tileWidth}},rotateBtn:function(){if(!this.isPaused&&!this.end){var e=this.num;if(1!=t.SHAPE_COORDS[this.shape].length){this.num+1==t.SHAPE_COORDS[this.shape].length?this.num=0:this.num+=1;for(var i=this.shapeTileArray[0],s=t.SHAPE_COORDS[this.shape][this.num],r=1;r<s.length;r++){var o=Math.round(i.x+s[r][0]*this.tileWidth),h=Math.round(i.y+s[r][1]*this.tileHeight);if(o<0||o>=this.shapeBoard.width||Math.abs(h)>=this.shapeBoard.height)return void(this.num=e);for(var n=0;n<this.confirmedTileArray.length;n++){var c=Math.round(this.confirmedTileArray[n].x),a=Math.round(this.confirmedTileArray[n].y);if(c==o&&a==h)return void(this.num=e)}}for(var l=1;l<s.length;l++){var d=s[l][0]*this.tileWidth+i.x,u=s[l][1]*this.tileHeight+i.y;this.shapeTileArray[l].position=cc.v2(d,u)}}}},chessRemove:function(){this.dropblock=[],cc.audioEngine.playEffect(this.removeAudio,!1);for(var e=Math.round(this.shapeTileArray[0].x),i=Math.round(this.shapeTileArray[0].y),t=0;t<s.CHESS_TYPE[this.chessType].length;t++)for(var r=0;r<this.confirmedTileArray.length;r++){var o=Math.round(this.confirmedTileArray[r].x+s.CHESS_TYPE[this.chessType][t][0]*this.tileWidth),h=Math.round(this.confirmedTileArray[r].y+s.CHESS_TYPE[this.chessType][t][1]*this.tileHeight);if(o==e&&h==i){this.particleLoc={x:this.confirmedTileArray[r].x+this.tileWidth/2,y:this.confirmedTileArray[r].y-this.tileHeight/2},this.dropblock.push([this.confirmedTileArray[r].x,this.confirmedTileArray[r].y]),this.tilePool1.put(this.confirmedTileArray[r]),this.confirmedTileArray.splice(r,1),this._onTouchBegin(),this.addScore();break}}0!=this.dropblock.length&&(this.updropflag=-1,this.scheduleOnce(function(){this.dropConfirmedTiles()},.5))},dropConfirmedTiles:function(){for(var e=0;e<this.dropblock.length;e++)for(var i=Math.round(this.dropblock[e][0]),t=Math.round(this.dropblock[e][1]),s=0;s<this.confirmedTileArray.length;s++){var r=Math.round(this.confirmedTileArray[s].x),o=Math.round(this.confirmedTileArray[s].y);i==r&&o>t&&(this.confirmedTileArray[s].y=this.confirmedTileArray[s].y+this.updropflag*this.tileHeight)}},judgeLose:function(){for(var e=0;e<this.confirmedTileArray.length;e++)if(Math.round(this.confirmedTileArray[e].y)>=0)return!0;return!1},lose:function(){this.unschedule(this.moveDown),this.end=!0,cc.audioEngine.stopMusic(),cc.audioEngine.playEffect(this.loseAudio),this.restartNode.active=!0,this.setBestScore()},setBestScore:function(){var e=cc.sys.localStorage.getItem("bestScore");if(e){if(this.score>Number(e)){cc.sys.localStorage.setItem("bestScore",String(this.score));var i={key:"score",value:String(this.score)};this.setNewCloudScore(i)}}else{cc.sys.localStorage.setItem("bestScore",String(this.score));var t={key:"score",value:String(this.score)};this.setNewCloudScore(t)}},setNewCloudScore:function(e){"undefined"!=typeof wx&&wx.setUserCloudStorage({KVDataList:[e],success:function(){console.log("\u66f4\u65b0\u73a9\u5bb6\u5206\u6570\u6210\u529f\uff01")},fail:function(e){console.log(e)}})},showRanks:function(){"undefined"!=typeof wx&&(this.wxSubContextView.active?(this.wxSubContextView.active=!1,wx.getOpenDataContext().postMessage({message:"clear"})):(this.wxSubContextView.active=!0,wx.getOpenDataContext().postMessage({message:"show"})))},initUserInfoButton:function(){if("undefined"!=typeof wx){var e=wx.getSystemInfoSync(),i=e.windowWidth,t=e.windowHeight,s=wx.createUserInfoButton({type:"text",text:"",style:{left:0,top:0,width:i,height:t,lineHeight:40,backgroundColor:"#00000000",color:"#00000000",textAlign:"center",fontSize:10,borderRadius:4}});s.onTap(function(e){e.userInfo?console.log("\u6388\u6743\u6210\u529f\uff01"):console.log("\u6388\u6743\u5931\u8d25\uff01"),s.hide(),s.destroy()})}},pauseResume:function(){this.end||(this.isPaused?(this.isPaused=!1,this.schedule(this.moveDown,1),cc.audioEngine.playMusic(this.bgAudio,!0),cc.audioEngine.setMusicVolume(.7),this.pauseResumeBtn.children[0].getComponent(cc.Sprite).spriteFrame=this.resumePic,this.pauseNode.active=!1):(this.isPaused=!0,this.unschedule(this.moveDown),cc.audioEngine.stopMusic(),this.pauseResumeBtn.children[0].getComponent(cc.Sprite).spriteFrame=this.pasuePic,this.pauseNode.active=!0))},restart:function(){cc.audioEngine.playEffect(this.btnAudio,!1),cc.director.loadScene("Game")},changeSence:function(){cc.director.loadScene("Game")},changeMainSence:function(){this.crazy=!1,cc.director.loadScene("Main")},start:function(){},_onTouchBegin:function(){var e=this.particleLoc;this.newClickNode(e,function(e){var i=this;e&&(e.getComponent(cc.ParticleSystem).resetSystem(),this.shapeBoard.children.forEach(function(e){"clickNode"===e.name&&e.getComponent(cc.ParticleSystem).stopped&&(i._clickPool.put(e),cc.log("\u987a\u5229\u56de\u6536..."))}))}.bind(this))},newClickNode:function(e,i){var t=null;this._clickPool||(this._clickPool=new cc.NodePool),this._clickPool.size()>0?(t=this._clickPool.get(),this.setClickNode(t,e,i)):cc.loader.loadRes("prefabs/particle_texture",cc.Prefab,function(s,r){s||(t=cc.instantiate(r),this.setClickNode(t,e,i))}.bind(this))},setClickNode:function(e,i,t){e.name="clickNode",e.setPosition(i),cc.log(i.x,i.y),cc.log(e.x,e.y),this.shapeBoard.addChild(e),t&&t(e)},recoverPreJudge:function(){for(var e=0;e<this.preJuTile.length;e++)this.preJuTile[e].width*=1.5,this.preJuTile[e].height*=1.5,this.preJuTile[e].opacity=255,this.preJuTile[e].x,this.tileWidth,this.preJuTile[e].y,this.tileHeight;this.preJuTile=[],this.colorRecover=[]},preJudge:function(){if(1!=this.tileType){for(var e={handsome:[[0,0],[0,1],[1,0],[1,1],[-1,0],[-1,1]],horse:[[1,1],[2,0],[-1,1],[-2,0]],scholar:[[-1,0],[1,0]],elephant:[[2,1],[-2,1]],car:[[0,0],[0,1],[0,2],[0,3]],cannon:[[0,1],[1,1],[-1,1]],soldier:[[0,0]]},i=this.shapeTileArray[0].x,t=-101010,s=0;s<this.confirmedTileArray.length;s++){var r=Math.round(this.confirmedTileArray[s].x),o=Math.round(this.confirmedTileArray[s].y);r==Math.round(i)&&o>t&&(t=this.confirmedTileArray[s].y)}for(var h=0;h<e[this.chessType].length;h++)for(var n=Math.round(i+e[this.chessType][h][0]*this.tileWidth),c=Math.round(t-e[this.chessType][h][1]*this.tileHeight),a=0;a<this.confirmedTileArray.length;a++){var l=Math.round(this.confirmedTileArray[a].x),d=Math.round(this.confirmedTileArray[a].y);n==l&&c==d&&(this.colorRecover.push(this.confirmedTileArray[a].color),this.preJuTile.push(this.confirmedTileArray[a]),this.confirmedTileArray[a].width/=1.5,this.confirmedTileArray[a].height/=1.5,this.confirmedTileArray[a].x,this.tileWidth,this.confirmedTileArray[a].y,this.tileHeight,this.confirmedTileArray[a].opacity=100)}}},makeATile:function(e,i){this.color=this.getColor();var t=e*this.tileWidth,s=-1*i*this.tileHeight,r=this.getTile();this.shapeBoard.addChild(r),r.color=this.color,r.position=cc.v2(t,s),r.width=this.tileWidth,r.height=this.tileHeight,this.confirmedTileArray.push(r)},upAlineMode:function(){for(var e=0;e<this.confirmedTileArray.length;e++)this.confirmedTileArray[e].y=this.confirmedTileArray[e].y+this.tileHeight;for(var i=0;i<this.col;i++)this.makeATile(i,14);this.judgeLose()&&this.lose()},upAFewMode:function(){for(var e=this.col,i=Math.floor(Math.random()*e),t=0;t<i;t++){for(var s=Math.floor(Math.random()*e),r=0;r<this.confirmedTileArray.length;r++)this.confirmedTileArray[r].x==s*this.tileWidth&&(this.confirmedTileArray[r].y=this.confirmedTileArray[r].y+this.tileHeight);this.makeATile(s,14)}this.judgeLose()&&this.lose()},registerEvent_monitor:function(){var e=this;this.node.on(cc.Node.EventType.TOUCH_END,function(i){var t=i.getStartLocation(),s=i.getLocation().sub(t),r=Math.atan2(s.y,s.x),o=cc.misc.radiansToDegrees(r),h=Math.floor(o/45);e.emitEventByIndex(h,1)},this)},emitEventByIndex:function(e,i){0===e||-1===e?this.aimNode.emit("RIGHT",i):1===e||2===e?this.aimNode.emit("UP"):-2===e||-3===e?this.aimNode.emit("DOWN"):-4===e||3===e||4===e?this.aimNode.emit("LEFT",i):cc.error("\u65e0\u6b64\u65b9\u5411"+e)},registerEvent:function(){var e=this;this.node.on("UP",function(){e.rotateBtn()},this),this.node.on("DOWN",function(){e.dropBtn()},this),this.node.on("LEFT",function(i){for(;i--;)e.leftBtn()},this),this.node.on("RIGHT",function(i){for(;i--;)e.rightBtn()},this)},activeShare:function(){if("undefined"!=typeof wx){var e=cc.sys.localStorage.getItem("bestScore");wx.shareAppMessage({title:"\u8fd9\u4e2a\u6e38\u620f\u6211\u73a9\u4e86"+e+"\u5206\uff0c\u6765\u8d85\u8d8a\u6211\u5427\uff01",imageUrl:cc.url.raw("img.png"),query:"shareMsg=\u5206\u4eab\u5361\u7247\u4e0a\u6240\u5e26\u7684\u4fe1\u606f"})}},passiveShare:function(){if("undefined"!=typeof wx){wx.showShareMenu({success:function(){console.log("\u5f00\u542f\u88ab\u52a8\u8f6c\u53d1\u6210\u529f\uff01")},fail:function(e){console.log(e),console.log("\u5f00\u542f\u88ab\u52a8\u8f6c\u53d1\u5931\u8d25\uff01")}});var e=cc.sys.localStorage.getItem("bestScore");wx.onShareAppMessage(function(){return{title:"\u8fd9\u4e2a\u6e38\u620f\u6211\u73a9\u4e86"+e+"\u5206\uff0c\u6765\u8d85\u8d8a\u6211\u5427\uff01",imageUrl:cc.url.raw("img.png"),query:"shareMsg=\u5206\u4eab\u5361\u7247\u4e0a\u6240\u5e26\u7684\u4fe1\u606f"}})}}}),cc._RF.pop()},{"./chessType":"chessType","./shape":"shape"}],chessType:[function(e,i,t){"use strict";cc._RF.push(i,"5126egfXS5FNpW6KHlV1Mji","chessType"),t.__esModule=!0,t.CHESS_TYPE=void 0,t.CHESS_TYPE={handsome:[[0,1],[0,2],[1,1],[1,2],[-1,1],[-1,2]],horse:[[1,2],[2,1],[-1,2],[-2,1]],scholar:[[-1,1],[1,1]],elephant:[[2,2],[-2,2]],car:[[0,1],[0,2],[0,3],[0,4]],cannon:[[0,2],[1,2],[-1,2]],soldier:[[0,1]]},cc._RF.pop()},{}],introduction:[function(e,i){"use strict";cc._RF.push(i,"2d7a0ikRxtB4ZbxkpG0gEIW","introduction"),cc.Class({extends:cc.Component,properties:{},changeMain:function(){cc.director.loadScene("Main")},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],main:[function(e,i){"use strict";cc._RF.push(i,"f3a49fJFL1Hnou51PZJWzgo","main"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},changeSence:function(){this.Mcrazy=0,cc.sys.localStorage.setItem("Mcrazy",this.Mcrazy),cc.director.loadScene("Game")},changeModel:function(){this.Mcrazy=1,cc.sys.localStorage.setItem("Mcrazy",this.Mcrazy),cc.director.loadScene("Game")},changeItro:function(){cc.director.loadScene("Introduction")},start:function(){}}),cc._RF.pop()},{}],shape:[function(e,i,t){"use strict";cc._RF.push(i,"d3752vG9jpNZ5n458wYLtqU","shape"),t.__esModule=!0,t.SHAPE_COORDS=void 0,t.SHAPE_COORDS={squareShape:[[[0,0],[0,1],[1,0],[1,1]]],lineShape:[[[0,0],[-1,0],[1,0],[2,0]],[[0,0],[0,-1],[0,1],[0,2]]],tShape:[[[0,0],[-1,0],[1,0],[0,-1]],[[0,0],[0,1],[1,0],[0,-1]],[[0,0],[-1,0],[0,1],[1,0]],[[0,0],[-1,0],[0,1],[0,-1]]],zShape:[[[0,0],[-1,0],[0,-1],[1,-1]],[[0,0],[0,-1],[1,0],[1,1]]],zShapeMirror:[[[0,0],[1,0],[0,-1],[-1,-1]],[[0,0],[0,1],[1,0],[1,-1]]],lShape:[[[0,0],[0,1],[1,0],[2,0]],[[0,0],[0,1],[0,2],[-1,0]],[[0,0],[0,-1],[-1,0],[-2,0]],[[0,0],[1,0],[0,-1],[0,-2]]],lShapeMirror:[[[0,0],[0,1],[-1,0],[-2,0]],[[0,0],[0,-1],[0,-2],[-1,0]],[[0,0],[0,-1],[1,0],[2,0]],[[0,0],[1,0],[0,1],[0,2]]]},cc._RF.pop()},{}]},{},["Game","chessType","introduction","main","shape"]);